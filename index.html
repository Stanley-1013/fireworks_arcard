<!DOCTYPE html><html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>å°ˆå±¬ç…™ç« AR å¡ç‰‡</title>
  <!-- A-Frame & æœ€æ–° AR.jsï¼ˆä¿æŒæ–°ç‰ˆï¼Œä¸é™ç´šï¼‰ -->
  $1
  <!-- ğŸ”§ THREE.Math å…¼å®¹æ€§ shimï¼šA-Frame 1.5 ä½¿ç”¨ THREE r158ï¼ŒèˆŠç‰ˆå¤–æ›ä»å‘¼å« THREE.Math.generateUUIDï¼Œå› æ­¤åœ¨è¼‰å…¥ç²’å­å¤–æ›å‰å…ˆè£œä¸Šå°æ‡‰æ–¹æ³•åˆ° Math -->
  <script>
    (function(){
      try {
        if (window.THREE) {
          // ç¢ºä¿æœ‰ THREE.Math ç‰©ä»¶
          if (!THREE.Math) THREE.Math = {};
          // è‹¥å¤–æ›å‘¼å«çš„æ˜¯èˆŠçš„ Math.generateUUIDï¼Œå°‡å…¶æŒ‡åˆ°æ–°çš„ MathUtils.generateUUID
          if (!THREE.Math.generateUUID && THREE.MathUtils && THREE.MathUtils.generateUUID) {
            THREE.Math.generateUUID = THREE.MathUtils.generateUUID;
          }
        }
      } catch (e) { console.warn('THREE shim failed', e); }
    })();
  </script>
  <!-- ç²’å­ç³»çµ± -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.1.3/dist/aframe-particle-system-component.min.js"></script>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, 'PingFang TC', 'Noto Sans TC', sans-serif; }
    a-scene { position:absolute; inset:0; width:100%; height:100%; background:#000; }
    .ui { position: fixed; inset: 0 0 auto 0; display: flex; flex-wrap: wrap; gap: .5rem; padding: .75rem; z-index: 10; pointer-events: none; }
    .ui .card { pointer-events: auto; background: rgba(0,0,0,.55); color: #fff; padding: .5rem .75rem; border-radius: .75rem; backdrop-filter: blur(6px); }
    .qr-tip { position: fixed; right: .75rem; bottom: .75rem; background: rgba(0,0,0,.55); color: #fff; padding: .5rem .75rem; border-radius: .75rem; font-size: .875rem; }
    .link { color: #bdf; text-decoration: underline; }
    #debug { position: fixed; left: .75rem; bottom: .75rem; background: rgba(0,0,0,.6); color: #fff; padding: .5rem .75rem; border-radius: .75rem; font-size: .85rem; z-index: 20; white-space: pre-line; }
  </style>
</head>
<body>
  <div class="ui">
    <div class="card">
      <div>ğŸª„ <b>ä½¿ç”¨èªªæ˜</b>ï¼šå°‡ã€ŒHiro æ¨™è¨˜ã€ç½®æ–¼é¡é ­å‰ï¼ˆå¯åœ¨å¦ä¸€å°è£ç½®é¡¯ç¤º <a class="link" href="https://jeromeetienne.github.io/AR.js/data/images/HIRO.jpg" target="_blank" rel="noopener">é€™å¼µåœ–</a>ï¼‰ï¼Œå°±æœƒåœ¨æ¨™è¨˜ä¸Šçœ‹åˆ° 3D ç…™ç«èˆ‡ç¥ç¦æ–‡å­—ã€‚</div>
    </div>
    <div class="card">ğŸ† <b>ç¥ç¦èª</b>ï¼š<span id="wish">é¡˜ä½ æ¯å¤©éƒ½èƒ½çœ‹åˆ°å°ˆå±¬çš„ç…™ç«ï¼</span></div>
  </div>
  <div class="qr-tip">æƒ³è‡ªè¨‚ç¥ç¦ï¼šåœ¨ç¶²å€å¾ŒåŠ  <code>?msg=ä½ çš„è©±</code></div>
  <div id="debug">â³ åˆå§‹åŒ–ä¸­â€¦</div><a-scene
vr-mode-ui="enabled: false"
embedded
renderer="alpha: true; precision: mediump; antialias: true"
arjs="trackingMethod: best; sourceType: webcam; facingMode: environment; debugUIEnabled: true;">

<a-entity light="type: ambient; intensity: 1"></a-entity>
<a-entity light="type: directional; intensity: .8" position="1 1 0"></a-entity>

<a-marker preset="hiro">
  <a-entity id="fw1" position="0 0 0" 
    particle-system="preset: dust; color: #fff, #ffd166, #ef476f, #06d6a0, #118ab2; particleCount: 400; size: 2; maxAge: 1.6; velocityValue: 0 4 0; accelerationValue: 0 -3 0; enabled: true;">
  </a-entity>
  <a-entity id="fw2" position="0.6 0.2 0" 
    particle-system="type: circle; color: #ffffff, #b5179e, #560bad; particleCount: 240; size: 1.6; maxAge: 1.2; velocityValue: 0 0 0; enabled: true;">
  </a-entity>
  <a-entity position="0 -0.25 0" rotation="-90 0 0" scale="0.4 0.4 0.4">
    <a-text id="msg3d" value="Happy Fireworks!" color="#ffffff" align="center" anchor="center"></a-text>
  </a-entity>
</a-marker>

<a-entity camera></a-entity>

  </a-scene>  <script>
    const $dbg = document.getElementById('debug');
    const log = (m)=>{ console.log(m); if ($dbg) $dbg.textContent = String(m); };

    // ä¸»å‹•è¦æ±‚ç›¸æ©Ÿæ¬Šé™ï¼Œä¸¦åœ¨æˆåŠŸå¾Œè®“ AR.js ç›´æ¥ä½¿ç”¨åŒä¸€å€‹ stream
    (async()=>{
      try {
        const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        log('âœ… ç›¸æ©Ÿæ¬Šé™å·²æˆäºˆï¼Œç­‰å¾… AR.js ä½¿ç”¨ç›¸æ©Ÿâ€¦');
        // å°‡ stream æ›åˆ° window æ–¹ä¾¿ debug
        window.__dbgStream = s;
      } catch(err) {
        console.error(err);
        log('âŒ ç›¸æ©Ÿæ¬Šé™å¤±æ•—: '+err.message);
        alert('è«‹åœ¨ç€è¦½å™¨è¨­å®šå…è¨±ç›¸æ©Ÿæ¬Šé™');
      }
    })();

    // è‡ªè¨‚ç¥ç¦
    const params = new URLSearchParams(location.search);
    const msg = (params.get('msg') || '').trim();
    if (msg) {
      document.getElementById('wish').textContent = msg;
      document.getElementById('msg3d').setAttribute('value', msg);
    }

    // ç…™ç«è§¸ç™¼
    const startBursts = () => {
      try {
        const fw1 = document.getElementById('fw1');
        const fw2 = document.getElementById('fw2');
        if (!fw1 || !fw2) return log('âš ï¸ æ‰¾ä¸åˆ°ç…™ç«å…ƒä»¶');
        const burst = (el) => {
          const cfg = el.getAttribute('particle-system') || '';
          el.setAttribute('particle-system', cfg + '; enabled: false');
          requestAnimationFrame(() => el.setAttribute('particle-system', cfg + '; enabled: true'));
        };
        setInterval(() => burst(fw1), 1500);
        setInterval(() => burst(fw2), 2200);
        log('âœ¨ AR å°±ç·’ï¼Œé–‹å§‹ç…™ç«');
      } catch (e) { console.error(e); log('âš ï¸ åˆå§‹åŒ–ç…™ç«å¤±æ•—'); }
    };

    // Debug äº‹ä»¶
    const scene = document.querySelector('a-scene');
    scene.addEventListener('loaded', () => log('ğŸ“¦ A-Frame å ´æ™¯è¼‰å…¥å®Œæˆ'));
    scene.addEventListener('arReady', () => { log('âœ¨ AR.js æº–å‚™å¥½äº†'); startBursts(); });
    scene.addEventListener('arError', (e) => { console.error('âš ï¸ AR.js åˆå§‹åŒ–éŒ¯èª¤:', e); log('âš ï¸ AR.js åˆå§‹åŒ–éŒ¯èª¤'); });
  </script></body>
</html>